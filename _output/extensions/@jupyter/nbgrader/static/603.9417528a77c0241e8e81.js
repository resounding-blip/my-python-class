"use strict";(self.webpackChunk_jupyter_nbgrader=self.webpackChunk_jupyter_nbgrader||[]).push([[603],{603:(e,t,s)=>{s.r(t),s.d(t,{commandIDs:()=>ee,default:()=>ie});var n=s(161),i=s(594),a=s(597),o=s(101),l=s(589),d=s(228),r=s(338),c=s(358),h=s(200),u=s(826),m=s(256),_=s(345);const g="nbgrader-ErrorDialog",p="nbgrader-SuccessDialog";function b(e={},t=!1){const s=new i.Dialog(e);return t?s.addClass(g):s.addClass(p),s.launch()}function v(e){var t=document.createElement("div");t.id="validation-message";var s,n,a=!1,o=!1;if(!0===e.success)if(void 0!==(e="string"==typeof e.value?JSON.parse(e.value):e.value).type_changed){a=!0;for(let i=0;i<e.type_changed.length;i++){var l=document.createElement("div");(s=document.createElement("p")).innerText=`The following ${e.type_changed[i].old_type} cell has changed to a ${e.type_changed[i].new_type} cell, but it should not have!`,l.append(s),t.append(l),(n=document.createElement("pre")).innerText=e.type_changed[i].source,t.append(n)}t.classList.add("validation-type-changed")}else if(void 0!==e.changed){a=!0;for(var d=0;d<e.changed.length;d++)l=document.createElement("div"),(s=document.createElement("p")).innerText="The source of the following cell has changed, but it should not have!",l.append(s),t.append(l),(n=document.createElement("pre")).innerText=e.changed[d].source,t.append(n);t.classList.add("validation-changed")}else if(void 0!==e.passed){for(d=0;d<e.changed.length;d++)l=document.createElement("div"),(s=document.createElement("p")).innerText="The following cell passed:",l.append(s),t.append(l),(n=document.createElement("pre")).innerText=e.passed[d].source,t.append(n);t.classList.add("validation-passed")}else if(void 0!==e.failed){for(a=!0,d=0;d<e.failed.length;d++){l=document.createElement("div"),(s=document.createElement("p")).innerText="The following cell failed:",l.append(s),t.append(l);const n=document.createElement("div");n.classList.add("jp-RenderedText");var r=document.createElement("pre");r.innerText=e.failed[d].source,n.append(r),t.append(n);const i=document.createElement("div");i.classList.add("jp-RenderedText");var c=document.createElement("pre");c.innerHTML=e.failed[d].error,i.append(c),t.append(i)}t.classList.add("validation-failed")}else l=document.createElement("div"),(s=document.createElement("p")).innerText="Success! Your notebook passes all the tests.",l.append(s),t.append(l),t.classList.add("validation-success"),o=!0;else a=!0,l=document.createElement("div"),(s=document.createElement("p")).innerText="There was an error running the validate command:",l.append(s),t.append(l),(n=document.createElement("pre")).innerText=e.value,t.append(n);let h;return h=new m.Widget({node:t}),b({title:"Validation Results",body:h,buttons:[i.Dialog.okButton()]},a),o}class f{constructor(e,t,s,n,i,o){this.list_loading_ids=["released_assignments_list_loading","fetched_assignments_list_loading","submitted_assignments_list_loading"],this.list_placeholder_ids=["released_assignments_list_placeholder","fetched_assignments_list_placeholder","submitted_assignments_list_placeholder"],this.list_error_ids=["released_assignments_list_error","fetched_assignments_list_error","submitted_assignments_list_error"],this.released_selector=t,this.fetched_selector=s,this.submitted_selector=n;var l=e.node.getElementsByTagName("div");this.released_element=l.namedItem(t),this.fetched_element=l.namedItem(s),this.submitted_element=l.namedItem(n),this.options=i,this.base_url=i.get("base_url")||a.PageConfig.getBaseUrl(),this.app=o,this.callback=void 0}clear_list(e){var t,s,n=[this.released_element,this.fetched_element,this.submitted_element];for(t=0;t<n.length;t++){for(s=0;s<n[t].children.length;++s)n[t].children[s].classList.contains("list_item")&&(n[t].removeChild(n[t].children[s]),--s);e?(n[t].children.namedItem(this.list_loading_ids[t]).hidden=!1,n[t].children.namedItem(this.list_placeholder_ids[t]).hidden=!0,n[t].children.namedItem(this.list_error_ids[t]).hidden=!0):(n[t].children.namedItem(this.list_placeholder_ids[t]).hidden=!1,n[t].children.namedItem(this.list_loading_ids[t]).hidden=!0,n[t].children.namedItem(this.list_error_ids[t]).hidden=!0)}}load_list_success(e){this.clear_list(!1);for(var t=e.length,s=0;s<t;s++){var n=document.createElement("div");new k(n,e[s],this.fetched_selector,(e=>{this.handle_load_list(e)}),this.options,this.app),"released"===e[s].status?(this.released_element.append(n),this.released_element.children.namedItem("released_assignments_list_placeholder").hidden=!0):"fetched"===e[s].status?(this.fetched_element.append(n),this.fetched_element.children.namedItem("fetched_assignments_list_placeholder").hidden=!0):"submitted"===e[s].status&&(this.submitted_element.append(n),this.submitted_element.children.namedItem("submitted_assignments_list_placeholder").hidden=!0)}var i=this.fetched_element.getElementsByClassName("assignment-notebooks-link");for(let e of i){var a=document.createElement("i");a.classList.add("fa","fa-caret-right"),e.append(a),e.onclick=function(t){e.children[0].classList.contains("fa-caret-right")?(e.children[0].classList.remove("fa-caret-right"),e.children[0].classList.add("fa-caret-down")):(e.children[0].classList.remove("fa-caret-down"),e.children[0].classList.add("fa-caret-right")),t.target.closest(".list_item").querySelector(".collapse").classList.toggle("in")}}this.callback&&(this.callback(),this.callback=void 0)}show_error(e){var t,s=[this.released_element,this.fetched_element,this.submitted_element];for(t=0;t<s.length;t++){for(var n=0;n<s[t].children.length;++n)s[t].children[n].classList.contains("list_item")&&(s[t].removeChild(s[t].children[n]),--n);s[t].children.namedItem(this.list_error_ids[t]).hidden=!1,s[t].children.namedItem(this.list_error_ids[t]).innerText=e,s[t].children.namedItem(this.list_loading_ids[t]).hidden=!0,s[t].children.namedItem(this.list_placeholder_ids[t]).hidden=!0}}handle_load_list(e){e.success?this.load_list_success(e.value):this.show_error(e.value)}async load_list(e,t){this.callback=t,this.clear_list(!0);try{const t=await I("assignments?course_id="+e,{method:"GET"});this.handle_load_list(t)}catch(e){console.error(`Error on GET /assignments.\n${e}`)}}}class k{constructor(e,t,s,n,i,o){this.element=e,this.data=t,this.parent=s,this.on_refresh=n,this.options=i,this.base_url=i.get("base_url")||a.PageConfig.getBaseUrl(),this.app=o,this.style(),this.make_row()}style(){this.element.classList.add("list_item","row")}escape_id(){var e="nbgrader-"+this.data.course_id+"-"+this.data.assignment_id;return(e=e.replace(/ /g,"_")).replace(/[^A-Za-z0-9\-_]/g,"")}make_link(){var e,t=document.createElement("span");if(t.classList.add("item_name","col-sm-6"),"fetched"===this.data.status){e=document.createElement("a");var s=this.escape_id();e.classList.add("collapsed","assignment-notebooks-link"),e.setAttribute("role","button"),e.setAttribute("data-toggle","collapse"),e.setAttribute("data-parent",this.parent),e.setAttribute("href","#"+s),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls",s)}else e=document.createElement("span");return e.innerText=this.data.assignment_id,t.append(e),t}submit_error(e){const t=_.createElement("p",null,"Assignment not submitted:"),s=_.createElement("pre",null,e.value);b({title:"Invalid Submission",body:_.createElement("div",{id:"submission-message"},[t,s]),buttons:[i.Dialog.okButton()]},!0)}make_button(){var e=document.createElement("span");e.classList.add("item_status","col-sm-4");var t=document.createElement("button");t.classList.add("btn","btn-primary","btn-xs"),e.append(t);var s=this;return"released"===this.data.status?(t.innerText="Fetch",t.onclick=async function(){t.innerText="Fetching...",t.setAttribute("disabled","disabled");const n={course_id:s.data.course_id,assignment_id:s.data.assignment_id};try{const e=await I("assignments/fetch",{body:JSON.stringify(n),method:"POST"});s.on_refresh(e)}catch(t){C(e),e.innerText="Error fetching assignment.",console.error(`Error on POST /assignment_list/fetch ${n}.\n${t}`)}}):"fetched"==this.data.status?(t.innerText="Submit",t.onclick=async function(){t.innerText="submitting...",t.setAttribute("disabled","disabled");const n={course_id:s.data.course_id,assignment_id:s.data.assignment_id};try{const e=await I("assignments/submit",{body:JSON.stringify(n),method:"POST"});e.success?s.on_refresh(e):(s.submit_error(e),t.innerText="Submit",t.removeAttribute("disabled"))}catch(t){C(e),e.innerText="Error submitting assignment.",console.error(`Error on POST /assignment_list/assignments/submit ${n}.\n${t}`)}}):"submitted"==this.data.status&&(t.innerText="Fetch Feedback",t.onclick=async function(){t.innerText="Fetching Feedback...",t.setAttribute("disabled","disabled");const n={course_id:s.data.course_id,assignment_id:s.data.assignment_id};try{const e=await I("assignments/fetch_feedback",{body:JSON.stringify(n),method:"POST"});s.on_refresh(e)}catch(t){C(e),e.innerText="Error fetching feedback.",console.error(`Error on POST /assignments/fetch_feedback ${n}.\n${t}`)}}),e}make_row(){var e=document.createElement("div");e.classList.add("col-md-12");var t=this.make_link();e.append(t);var s,n,i=document.createElement("span");i.classList.add("item_course","col-sm-2"),i.innerText=this.data.course_id,e.append(i);var a=document.createElement("div");if("submitted"==this.data.status){s=this.escape_id()+"-submissions",a.id=s,a.classList.add("panel-collapse","list_container","assignment-notebooks"),a.setAttribute("role","tabpanel"),(l=document.createElement("div")).classList.add("list_item","row"),a.append(l);for(var o=0;o<this.data.submissions.length;o++)n=document.createElement("div"),new w(n,this.data.submissions[o],this.options,this.app),a.append(n)}else if("fetched"===this.data.status){var l;for(s=this.escape_id(),a.id=s,a.classList.add("panel-collapse","list_container","assignment-notebooks","collapse"),a.setAttribute("role","tabpanel"),(l=document.createElement("div")).classList.add("list_item","row"),a.append(l),o=0;o<this.data.notebooks.length;o++)n=document.createElement("div"),this.data.notebooks[o].course_id=this.data.course_id,this.data.notebooks[o].assignment_id=this.data.assignment_id,new E(n,this.data.notebooks[o],this.options,this.app),a.append(n)}e.append(this.make_button()),this.element.innerHTML="",this.element.append(e),this.element.append(a)}}const C=function(e){e.innerHTML=""};class w{constructor(e,t,s,n){this.element=e,this.data=t,this.options=s,this.base_url=s.get("base_url")||a.PageConfig.getBaseUrl(),this.app=n,this.style(),this.make_row()}style(){this.element.classList.add("list_item","row","nested_list_item")}make_row(){var e=document.createElement("div");e.classList.add("col-md-12");var t=document.createElement("span");t.classList.add("item_name","col-sm-6");var s=document.createElement("span").innerText=this.data.timestamp;if(t.append(s),this.data.has_local_feedback&&!this.data.feedback_updated){var n=this.app,i=this.data.local_feedback_path,a=document.createElement("a");a.onclick=function(){n.commands.execute("filebrowser:go-to-path",{path:i})},a.innerText=" (view feedback)",t.append(a)}else if(this.data.has_exchange_feedback)(o=document.createElement("span")).innerText=" (feedback available to fetch)",t.append(o);else{var o;(o=document.createElement("span")).innerText="",t.append(o)}e.append(t);var l=document.createElement("span");l.classList.add("item_course","col-sm-2"),e.append(l);var d=document.createElement("span");d.classList.add("item_status","col-sm-4"),e.append(d),this.element.append(e)}}class E{constructor(e,t,s,n){this.element=e,this.data=t,this.options=s,this.base_url=s.get("base_url")||a.PageConfig.getBaseUrl(),this.app=n,this.style(),this.make_row()}style(){this.element.classList.add("list_item","row","nested_list_item")}make_button(){var e=this,t=document.createElement("span");t.classList.add("item_status","col-sm-4");var s=document.createElement("button");return s.classList.add("btn","btn-default","btn-xs"),t.append(s),s.innerText="Validate",s.onclick=async function(){s.innerText="Validating...",s.setAttribute("disabled","disabled");const n={path:e.data.path};try{const t=await I("assignments/validate",{body:JSON.stringify(n),method:"POST"});s.innerText="Validate",s.removeAttribute("disabled"),v(t)?e.validate_success(s):e.validate_failure(s)}catch(e){C(t),t.innerText="Error validating assignment.",console.error(`Error on POST /assignments/validate ${n}.\n${e}`)}},t}validate_success(e){e.classList.remove("btn-default","btn-danger","btn-success"),e.classList.add("btn-success")}validate_failure(e){e.classList.remove("btn-default","btn-danger","btn-success"),e.classList.add("btn-danger")}make_row(){var e=this.app,t=this.data.path,s=document.createElement("div");s.classList.add("col-md-12");var n=document.createElement("span");n.classList.add("item_name","col-sm-6");var i=document.createElement("a");i.href="#",i.innerText=this.data.notebook_id,i.onclick=function(){e.commands.execute("docmanager:open",{path:t})},n.append(i),s.append(n);var a=document.createElement("span");a.classList.add("item_course","col-sm-2"),s.append(a),s.append(this.make_button()),this.element.append(s)}}class y{constructor(e,t,s,n,i,o,l){this.options=new Map,this.course_list_selector=t,this.default_course_selector=s,this.dropdown_selector=n,this.refresh_selector=i,this.course_list_element=e.node.getElementsByTagName("ul").namedItem(t);var d=e.node.getElementsByTagName("button");this.default_course_element=d.namedItem(s),this.dropdown_element=d.namedItem(n),this.refresh_element=d.namedItem(i),this.assignment_list=o,this.current_course=void 0,this.options=l,this.base_url=l.get("base_url")||a.PageConfig.getBaseUrl(),this.data=void 0;var r=this;this.dropdown_element.onclick=function(){r.course_list_element.classList.toggle("open")},document.onclick=function(e){e.target.closest("button")!=r.dropdown_element&&r.course_list_element.classList.remove("open")},this.refresh_element.onclick=function(){r.load_list()},this.bind_events()}enable_list(){this.dropdown_element.removeAttribute("disabled")}disable_list(){this.dropdown_element.setAttribute("disabled","disabled")}clear_list(){this.course_list_element.children.length>0&&(this.course_list_element.innerHTML="")}bind_events(){this.refresh_element.click()}async load_list(){this.disable_list(),this.clear_list(),this.assignment_list.clear_list(!0);try{const e=await I("courses");this.handle_load_list(e)}catch(e){console.error(`Error on GET /courses.\n${e}`)}}handle_load_list(e){e.success?this.load_list_success(e.value):(this.default_course_element.innerText="Error fetching courses!",this.enable_list(),this.assignment_list.show_error(e.value))}load_list_success(e){if(this.data=e,this.disable_list(),this.clear_list(),0===this.data.length)return this.default_course_element.innerText="No courses found.",this.assignment_list.clear_list(!1),void this.enable_list();this.data.includes(this.current_course)||(this.current_course=void 0),void 0===this.current_course?this.change_course(this.data[0]):this.change_course(this.current_course)}change_course(e){this.disable_list(),void 0!==this.current_course&&(this.default_course_element.innerText=e),this.current_course=e,this.default_course_element.innerText=this.current_course,this.assignment_list.load_list(e,(()=>{this.load_assignment_list_success()}))}load_assignment_list_success(){if(this.data){for(var e=this,t=function(t){return function(){e.change_course(t)}},s=0;s<this.data.length;s++){var n=document.createElement("a");n.href="#",n.innerText=this.data[s];var i=document.createElement("li");i.append(n),i.onclick=t(this.data[s]),this.course_list_element.append(i)}this.data=void 0}this.enable_list()}}async function I(e="",t={}){const s=c.ServerConnection.makeSettings(),n=a.URLExt.join(s.baseUrl,e);let i;try{i=await c.ServerConnection.makeRequest(n,t,s)}catch(e){throw new c.ServerConnection.NetworkError(e)}const o=await i.json();if(!i.ok)throw new c.ServerConnection.ResponseError(i,o.message);return o}class L extends m.Widget{constructor(e){super(),this.app=e;var t=['<div id="assignments" class="tab-pane">','  <div id="assignments_toolbar" class="row list_toolbar">','    <div class="col-sm-8 no-padding">','      <span id="assignments_list_info" class="toolbar_info">Released, downloaded, and submitted assignments for course:</span>','      <div class="btn-group btn-group-xs">','        <button type="button" class="btn btn-default" id="course_list_default">Loading, please wait...</button>','        <button type="button" class="btn btn-default dropdown-toggle" id="course_list_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" disabled="disabled">','          <span class="caret"></span>','          <span class="sr-only">Toggle Dropdown</span>',"        </button>",'        <ul class="dropdown-menu" id="course_list">',"        </ul>","      </div>","    </div>",'    <div class="col-sm-4 no-padding tree-buttons">','      <span id="assignments_buttons" class="pull-right toolbar_buttons">','      <button id="refresh_assignments_list" title="Refresh assignments list" class="btn btn-default btn-xs"><i class="fa fa-refresh"></i></button>',"      </span>","    </div>","  </div>",'  <div class="alert alert-danger version_error">',"  </div>",'  <div class="panel-group">','    <div class="panel panel-default">','      <div class="panel-heading">',"        Released assignments","      </div>",'      <div class="panel-body">','        <div id="released_assignments_list" class="list_container">','          <div id="released_assignments_list_placeholder" class="list_placeholder">',"            <div> There are no assignments to fetch. </div>","          </div>",'          <div id="released_assignments_list_loading" class="list_loading">',"            <div> Loading, please wait... </div>","          </div>",'          <div id="released_assignments_list_error" class="list_error">',"            <div></div>","          </div>","        </div>","      </div>","    </div>",'    <div class="panel panel-default">','      <div class="panel-heading">',"        Downloaded assignments","      </div>",'      <div class="panel-body">','        <div id="fetched_assignments_list" class="list_container" role="tablist" aria-multiselectable="true">','          <div id="fetched_assignments_list_placeholder" class="list_placeholder">',"            <div> There are no downloaded assignments. </div>","          </div>",'          <div id="fetched_assignments_list_loading" class="list_loading">',"            <div> Loading, please wait... </div>","          </div>",'          <div id="fetched_assignments_list_error" class="list_error">',"            <div></div>","          </div>","        </div>","      </div>","    </div>",'    <div class="panel panel-default">','      <div class="panel-heading">',"        Submitted assignments","      </div>",'      <div class="panel-body">','        <div id="submitted_assignments_list" class="list_container">','          <div id="submitted_assignments_list_placeholder" class="list_placeholder">',"            <div> There are no submitted assignments. </div>","          </div>",'          <div id="submitted_assignments_list_loading" class="list_loading">',"            <div> Loading, please wait... </div>","          </div>",'          <div id="submitted_assignments_list_error" class="list_error">',"            <div></div>","          </div>","        </div>","      </div>","    </div>","  </div>   ","</div>"].join("\n");this.node.innerHTML=t,this.node.style.overflowY="auto";let s=a.PageConfig.getBaseUrl(),n=new Map;n.set("base_url",s);var i=new f(this,"released_assignments_list","fetched_assignments_list","submitted_assignments_list",n,this.app);new y(this,"course_list","course_list_default","course_list_dropdown","refresh_assignments_list",i,n),this.checkNbGraderVersion()}checkNbGraderVersion(){var e=this.node.getElementsByClassName("version_error")[0];e.hidden=!1,I("nbgrader_version?version=0.9.5").then((t=>{t.success||(e.innerText=t.message,e.style.display="block")})).catch((e=>{console.error(`Error on GET /assignment_list/nbgrader_version.\n${e}`)}))}}class T extends i.IFrame{constructor(e,t){super(),this.referrerPolicy="strict-origin-when-cross-origin",this.sandbox=["allow-scripts","allow-same-origin","allow-forms"],this.node.id="formgrader-iframe",this.app=e,this.url=t;var s=this;window.addEventListener("message",(function(e){s.on_message(e)}))}on_message(e){if(this.node.querySelector("iframe").contentWindow===e.source){var t=JSON.parse(e.data);this.app.commands.execute(t.command,t.arguments)}}}async function x(e="",t={}){const s=c.ServerConnection.makeSettings(),n=a.URLExt.join(s.baseUrl,e);let i;try{i=await c.ServerConnection.makeRequest(n,t,s)}catch(e){throw new c.ServerConnection.NetworkError(e)}const o=await i.json();if(!i.ok)throw new c.ServerConnection.ResponseError(i,o.message);return o}function N(e,t,s){var n=document.createElement("div");n.classList.add("list_item","row");var i=document.createElement("div");i.classList.add("col-md-12");var a=document.createElement("span");a.classList.add("item_name","col-sm-2");var o=document.createElement("a");if(o.href="#",o.innerText=e.course_id,"local"==e.kind)o.href="#",o.onclick=function(){t.commands.execute(ee.openFormgrader,e)};else{const t=e.url;o.href=s?t.replace(/\/lab(\/|\?)?/,"/tree$1"):t,o.target="blank"}var l=document.createElement("span");return l.classList.add("item_course","col-sm-2"),l.textContent=e.kind,a.append(o),i.append(a),i.append(l),n.append(i),n}class S{constructor(e,t,s){this.course_list_element=e,this.app=t,this._isNotebook=s,this.listplaceholder=document.createElement("div"),this.listplaceholder.id="formgrader_list_placeholder",this.listplaceholder.classList.add("list_placeholder");var n=document.createElement("div");n.textContent="There are no available formgrader services.",this.listplaceholder.hidden=!0,this.listplaceholder.appendChild(n),this.course_list_element.appendChild(this.listplaceholder),this.listloading=document.createElement("div"),this.listloading.id="formgrader_list_loading",this.listloading.classList.add("list_loading");var i=document.createElement("div");i.textContent="Loading, please wait...",this.listloading.appendChild(i),this.course_list_element.appendChild(this.listloading),this.listerror=document.createElement("div"),this.listerror.id="formgrader_list_error",this.listerror.classList.add("list_error"),this.listerrortext=document.createElement("div"),this.listerrortext.textContent="There are no available formgrader services.",this.listerror.hidden=!0,this.listerror.appendChild(this.listerrortext),this.course_list_element.appendChild(this.listerror)}clear_list(e){for(;this.course_list_element.lastChild.classList.contains("list_item");)this.course_list_element.removeChild(this.course_list_element.lastChild);e?(this.listloading.hidden=!1,this.listplaceholder.hidden=!0,this.listerror.hidden=!0):(this.listplaceholder.hidden=!1,this.listloading.hidden=!0,this.listerror.hidden=!0)}show_error(e){for(;this.course_list_element.lastChild.classList.contains("list_item");)this.course_list_element.removeChild(this.course_list_element.lastChild);this.listerrortext.textContent=e.message,this.listerror.hidden=!1,this.listloading.hidden=!0,this.listplaceholder.hidden=!0}load_list(){this.clear_list(!0),x("formgraders").then((e=>this.handle_load_list.call(this,e))).catch(this.show_error)}handle_load_list(e){e.success?this.load_list_success(e.value):this.show_error(e.value)}load_list_success(e){this.clear_list(!1);var t=e.length;t>0&&(this.listplaceholder.hidden=!0);for(var s=0;s<t;s++)this.course_list_element.appendChild(N(e[s],this.app,this._isNotebook))}}class P extends m.Widget{constructor(e,t){super(),this.app=e;var s=document.createElement("div");s.id="courses",s.classList.add("tab-pane"),this.version_alert=document.createElement("div"),this.version_alert.classList.add("alert","alert-danger","version_error"),this.version_alert.hidden=!0,s.appendChild(this.version_alert);var n=document.createElement("div");n.classList.add("panel-group");var i=document.createElement("div");i.classList.add("panel","panel-default");var a=document.createElement("div");a.classList.add("panel-heading"),a.textContent="Available formgraders";var o=document.createElement("span");o.id="formgrader_buttons",o.classList.add("pull-right","toolbar_buttons");var l=document.createElement("button");l.id="refresh_formgrader_list",l.title="Refresh formgrader list",l.classList.add("btn","btn-default","btn-xs");var d=document.createElement("i");d.classList.add("fa","fa-refresh"),l.appendChild(d),o.appendChild(l),a.appendChild(o),i.appendChild(a);var r=document.createElement("div");r.classList.add("panel-body");var c=document.createElement("div");c.id="formgrader_list",c.classList.add("list_container"),this.courselist=new S(c,this.app,t),r.appendChild(c),i.appendChild(r),n.appendChild(i),s.appendChild(n),this.node.appendChild(s),this.node.style.overflowY="auto",l.onclick=()=>this.courselist.load_list.call(this.courselist),this.checkNbGraderVersion(),this.courselist.load_list()}checkNbGraderVersion(){x("nbgrader_version?version=0.9.5").then((e=>{e.success||(this.version_alert.textContent=e.message,this.version_alert.hidden=!1)})).catch((e=>{console.error(`The course_list server extension appears to be missing.\n${e}`)}))}}var W=s(602);const M="nbgrader";var A,D,B;!function(e){function t(e,t){null!==e?t.setMetadata(M,e.toJson()):t.getMetadata(M)&&t.deleteMetadata(M)}e.cleanNbgraderData=function(s,n){const i=e.getNbgraderData(s);return!(null===i||!(null==i?void 0:i.isInvalid(n))||(i.data.schema_version=3,i.data.solution=!1,i.data.grade=!1,i.data.locked=!1,i.data.task=!1,t(i,s),0))},e.clearCellType=function(e){const t=e.getMetadata(M);null!=t&&("cell_type"in t&&(t.cell_type=void 0),e.setMetadata(M,t))},e.getNbgraderData=function(e){if(null===e)return null;const t=e.getMetadata(M);return void 0===t?null:new V(t.valueOf())},e.isGraded=function(e){return null==e?void 0:e.isGradable()},e.isRelevantToNbgrader=function(e){return(null==e?void 0:e.isGradable())||(null==e?void 0:e.isSolution())},e.newNbgraderData=function(e){if(""===e.type)return null;const t={grade:B.getGrade(e),grade_id:B.getGradeId(e),locked:B.getLocked(e),points:B.getPoints(e),schema_version:B.getSchemeaVersion(),solution:B.getSolution(e),task:B.getTask(e)};return new V(t)},e.newToolData=function(e,t){const s=new G;return(null==e?void 0:e.isInvalid(t))?(s.type="",s):(s.type=(null==e?void 0:e.getType(t))||"",""===s.type||(((null==e?void 0:e.isGrade())||(null==e?void 0:e.isSolution())||(null==e?void 0:e.isLocked()))&&(s.id=(null==e?void 0:e.getGradeId())||""),(null==e?void 0:e.isGradable())&&(s.points=(null==e?void 0:e.getPoints())||0),s.locked=(null==e?void 0:e.isLocked())||!1),s)},e.setNbgraderData=t}(A||(A={})),function(e){e._to_float=function(e){if(null==e||""===e)return 0;const t=typeof e;return"string"===t?parseFloat(e):"number"===t?e:0}}(D||(D={})),function(e){e.getGrade=function(e){return"manual"===e.type||"tests"===e.type},e.getGradeId=function(e){return null===e.id?"":e.id},e.getLocked=function(t){return!(e.getSolution(t)||!e.getGrade(t)&&"task"!==t.type&&"tests"!==t.type&&"readonly"!==t.type)},e.getPoints=function(t){if(e.getGrade(t)||e.getTask(t))return t.points>=0?t.points:0},e.getSchemeaVersion=function(){return 3},e.getSolution=function(e){return"manual"===e.type||"solution"===e.type},e.getTask=function(e){return"task"===e.type}}(B||(B={}));class V{constructor(e){this._data={},this._data=e}get data(){return this._data}set data(e){this._data=e}getGradeId(){return this.data.grade_id||""}getPoints(){return D._to_float(this.data.points||0)}getSchemaVersion(){var e;return(null===(e=this.data)||void 0===e?void 0:e.schema_version)||3}getType(e){return this.isTask()?"task":this.isSolution()&&this.isGrade()?"manual":this.isSolution()&&"code"===e?"solution":this.isGrade()&&"code"===e?"tests":this.isLocked()?"readonly":""}isGrade(){return this._data.grade||!1}isGradable(){return this.isGrade()||this.isTask()}isInvalid(e){return!this.isTask()&&"code"!==e&&this.isSolution()!==this.isGrade()}isLocked(){return!this.isSolution()&&(this.isGradable()||this._data.locked)}isTask(){return this._data.task||!1}isSolution(){return this._data.solution||!1}toJson(){const e={};return void 0!==this.data.grade&&(e.grade=this.data.grade),void 0!==this.data.grade_id&&(e.grade_id=this.data.grade_id),void 0!==this.data.locked&&(e.locked=this.data.locked),void 0!==this.data.points&&(e.points=this.data.points),void 0!==this.data.schema_version&&(e.schema_version=this.data.schema_version),void 0!==this.data.solution&&(e.solution=this.data.solution),void 0!==this.data.task&&(e.task=this.data.task),e}}class G{}const R="nbgrader-mod-active",F="nbgrader-mod-highlight",O="nbgrader-mod-locked",j="nbgrader-mod-uneditable";function $(e={}){const t=new i.Dialog(e);return t.addClass("nbgrader-ErrorDialog"),t.launch()}class H extends m.Panel{constructor(e,t){super(),this._notebookPanelWidgets=new Map,this.addClass("nbgrader-CreateAssignmentWidget"),e.currentChanged.connect(this._onCurrentNotebookChange,this),t&&t.currentChanged.connect(this._onMainAreaActiveChange,this),this._activeNotebook=null,this._notebookTracker=e,this._labShell=t}dispose(){if(!this.isDisposed){if(null!=this._notebookPanelWidgets)for(const e of this._notebookPanelWidgets)e[1].dispose();this._notebookTracker.currentChanged.disconnect(this._onCurrentNotebookChange,this),this._labShell&&this._labShell.currentChanged.disconnect(this._onMainAreaActiveChange,this),this._activeNotebook=null,this._notebookPanelWidgets=null,this._notebookTracker=null,super.dispose()}}onBeforeShow(e){if(super.onBeforeShow(e),null!=this._activeNotebook){const e=this._notebookPanelWidgets.get(this._activeNotebook);null==e?this._addNotebookWidget(this._notebookTracker,this._activeNotebook):e.show()}}isAvailable(){return null!==this._activeNotebook&&this._activeNotebook.isVisible}onAfterShow(){if(!this._labShell)return;const e=this._labShell.widgets("main");if(null==this._activeNotebook)this._hideRightPanel();else for(let t of e)t.title==this._activeNotebook.title&&(t.isVisible?t.activate():this._hideRightPanel())}async _addNotebookWidget(e,t){if(null===t)return;await t.revealed;const s=new Y(t);return this.addWidget(s),this._notebookPanelWidgets.set(t,s),t.disposed.connect((()=>{s.dispose()})),s.disposed.connect((()=>{this._notebookPanelWidgets.delete(t)})),e.currentWidget!=t&&s.hide(),t.revealed}async _onCurrentNotebookChange(e,t){if(null!=this._activeNotebook){const e=this._notebookPanelWidgets.get(this._activeNotebook);null!=e&&e.hide()}if(null!=t){this.isVisible&&null==this._notebookPanelWidgets.get(t)&&await this._addNotebookWidget(e,t);const s=this._notebookPanelWidgets.get(t);null!=s&&s.show()}this._activeNotebook=t}_onMainAreaActiveChange(e,t){t.newValue instanceof d.NotebookPanel||!this.isVisible||this._hideRightPanel()}_hideRightPanel(){this._labShell.collapseRight()}}class U extends m.Panel{constructor(e,t){super(),this._click=new W.Signal(this),this._notebookPanel=t,this._cellModel=e,this._cellModel.metadataChanged.connect(this._onMetadataChange,this),this._initLayout(),this._initInputListeners(),this._initMetadata(e),this.addClass("nbgrader-CellWidget"),this.node.addEventListener("click",this._onClick.bind(this)),this.cellModel.stateChanged.connect(this._onStateChange,this),this._updatePrompt()}get cellModel(){return this._cellModel}cleanNbgraderData(e){A.cleanNbgraderData(e,e.type)}get click(){return this._click}dispose(){this.isDisposed||(this.cellModel.metadataChanged.disconnect(this._onMetadataChange,this),this.node.removeEventListener("click",this._onClick),this.cellModel.stateChanged.disconnect(this._onStateChange,this),null!=this._taskInput&&(this._taskInput.onchange=null),null!=this._gradeIdInput&&(this._gradeIdInput.onchange=null),null!=this._pointsInput&&(this._pointsInput.onchange=null),this._cellModel=null,this._click=null,this._lock=null,this._gradeId=null,this._points=null,this._taskInput=null,this._gradeIdInput=null,this._pointsInput=null,super.dispose())}setActive(e){e?(this.addClass(R),this._updatePrompt()):this.removeClass(R)}_updatePrompt(){this._headerElement.removeChild(this._promptNode);const e=this._notebookPanel.content.widgets.find((e=>e.model.id===this.cellModel.id));e&&e.promptNode?this._promptNode=e.promptNode.cloneNode(!0):this._promptNode=document.createElement("div"),this._headerElement.insertBefore(this._promptNode,this._headerElement.firstChild)}_onStateChange(e,t){"executionCount"==t.name&&this._updatePrompt()}_onMetadataChange(e,t){const s=A.getNbgraderData(e),n=A.newToolData(s,this.cellModel.type);this._updateValues(n)}_getOnInputChanged(){return()=>{const e=new G;if(e.type=this._taskInput.value,this._gradeId.classList.contains(j)){const t=A.getNbgraderData(this.cellModel);null==(null==t?void 0:t.data.grade_id)?e.id="cell-"+this._randomString(16):e.id=t.data.grade_id,this._gradeIdInput.value=e.id}else e.id=this._gradeIdInput.value;this._points.classList.contains(j)||(e.points=this._pointsInput.valueAsNumber);const t=A.newNbgraderData(e);A.setNbgraderData(t,this.cellModel)}}_getOnTaskInputChanged(){const e=this._getOnInputChanged();return()=>{e(),this._updateDisplayClass()}}_onClick(){this._click.emit()}_initInputListeners(){this._taskInput.onchange=this._getOnTaskInputChanged(),this._gradeIdInput.onchange=this._getOnInputChanged(),this._pointsInput.onchange=this._getOnInputChanged()}_initLayout(){const e=document.createElement("div"),t=this._newHeaderElement(),s=this._newTaskElement(),n=this._newIdElement(),i=this._newPointsElement(),a=[t,s,n,i],o=document.createDocumentFragment();for(const e of a)o.appendChild(e);e.appendChild(o),this.node.appendChild(e),this._headerElement=t,this._lock=t.getElementsByTagName("a")[0],this._gradeId=n,this._points=i,this._taskInput=s.getElementsByTagName("select")[0],this._gradeIdInput=n.getElementsByTagName("input")[0],this._pointsInput=i.getElementsByTagName("input")[0]}async _initMetadata(e){this.cleanNbgraderData(e);const t=A.getNbgraderData(e),s=A.newToolData(t,this.cellModel.type);A.clearCellType(e),this._updateDisplayClass(),this._updateValues(s)}_newHeaderElement(){const e=document.createElement("div");e.className="nbgrader-CellHeader",this._promptNode=document.createElement("div"),e.appendChild(this._promptNode);const t=document.createElement("a");t.className="nbgrader-LockButton";const s=document.createElement("li");return s.className="fa fa-lock",s.title="Student changes will be overwritten",t.appendChild(s),e.appendChild(t),e}_newIdElement(){const e=document.createElement("div");e.className="nbgrader-CellId";const t=document.createElement("label");t.textContent="ID: ";const s=document.createElement("input");return s.type="text",t.appendChild(s),e.appendChild(t),e}_newPointsElement(){const e=document.createElement("div");e.className="nbgrader-CellPoints";const t=document.createElement("label");t.textContent="Points: ";const s=document.createElement("input");return s.type="number",s.min="0",t.appendChild(s),e.appendChild(t),e}_newTaskElement(){const e=document.createElement("div");e.className="nbgrader-CellType";const t=document.createElement("label");t.textContent="Type: ";const s=document.createElement("select"),n=new Map([["","-"],["manual","Manually graded answer"],["task","Manually graded task"],["solution","Autograded answer"],["tests","Autograded tests"],["readonly","Read-only"]]);"code"!==this.cellModel.type&&(n.delete("solution"),n.delete("tests"));const a=document.createDocumentFragment();for(const e of n.entries()){const t=document.createElement("option");t.value=e[0],t.innerHTML=e[1],a.appendChild(t)}s.appendChild(a);const o=i.Styling.wrapSelect(s);return t.appendChild(o),e.appendChild(t),e}_randomString(e){var t,s="";for(t=0;t<e;t++)s+="abcdef0123456789"[Math.floor(16*Math.random())];return s}_setGradeId(e){this._gradeIdInput.value=e}_setElementEditable(e,t){t?e.classList.remove(j):e.classList.add(j)}_setGradeIdEditable(e){this._setElementEditable(this._gradeId,e)}_setPoints(e){this._pointsInput.value=e.toString()}_setPointsEditable(e){this._setElementEditable(this._points,e)}_setTask(e){this._taskInput.value=e}_updateDisplayClass(){const e=A.getNbgraderData(this.cellModel);A.isRelevantToNbgrader(e)?this.addClass(F):this.removeClass(F)}_updateValues(e){this._setTask(e.type),null==e.id?(this._setGradeIdEditable(!1),this._setGradeId("")):(this._setGradeId(e.id),this._setGradeIdEditable(!0)),null==e.points?(this._setPointsEditable(!1),this._setPoints(0)):(this._setPoints(e.points),this._setPointsEditable(!0)),e.locked?this._lock.classList.add(O):this._lock.classList.remove(O)}}class J extends m.Widget{constructor(){super(),this.addClass("nbgrader-NotebookHeaderWidget"),this._initLayout()}dispose(){this.isDisposed||(this._pointsInput=null,super.dispose())}set totalPoints(e){null!=this._pointsInput&&(this._pointsInput.value=e.toString())}_initLayout(){const e=this._newTotalPointsElement();this.node.appendChild(e),this._pointsInput=e.getElementsByTagName("input")[0]}_newTotalPointsElement(){const e=document.createElement("div");e.className="nbgrader-NotebookPoints";const t=document.createElement("label");t.innerText="Total points:";const s=document.createElement("input");return s.className="nbgrader-TotalPointsInput",s.type="number",s.disabled=!0,t.appendChild(s),e.appendChild(t),e}}class q extends m.Panel{constructor(e){super(),this._activeCellModel=null,this._cellMetadataChanged=new W.Signal(this),this._cellWidgets=new Map,this._activeCellModel=e.content.activeCell.model,this._notebookPanel=e,this.addClass("nbgrader-NotebookWidget"),this._initCellWidgets(e.content),this._validateSchemaVersion(),this._notebookPanel.content.activeCellChanged.connect(this._onActiveCellChange,this),this._notebookPanel.model.cells.changed.connect(this._onCellsListChange,this),this._notebookPanel.disposed.connect(this._onNotebookDisposed,this),this._notebookPanel.context.saveState.connect(this._onValidateIds,this)}dispose(){var e,t,s,n,i,a,o,l,d,r,c,h,u;if(!this.isDisposed){if(null!=this._cellWidgets)for(const e of this._cellWidgets)this._removeCellWidget(e[1]);null===(s=null===(t=null===(e=this.notebookPanel)||void 0===e?void 0:e.content)||void 0===t?void 0:t.activeCellChanged)||void 0===s||s.disconnect(this._onActiveCellChange,this),null===(o=null===(a=null===(i=null===(n=this.notebookPanel)||void 0===n?void 0:n.model)||void 0===i?void 0:i.cells)||void 0===a?void 0:a.changed)||void 0===o||o.disconnect(this._onCellsListChange,this),null===(r=null===(d=null===(l=this.notebookPanel)||void 0===l?void 0:l.context)||void 0===d?void 0:d.saveState)||void 0===r||r.disconnect(this._onValidateIds,this),null===(h=null===(c=this.notebookPanel)||void 0===c?void 0:c.disposed)||void 0===h||h.disconnect(this._onNotebookDisposed,this),null===(u=this.notebookPanel)||void 0===u||u.dispose(),this._activeCellModel=null,this._cellMetadataChanged=null,this._cellWidgets=null,this._notebookPanel=null,super.dispose()}}get cellMetadataChanged(){return this._cellMetadataChanged}get notebookPanel(){return this._notebookPanel}_onCellsListChange(e,t){switch(t.type){case"add":this._addCellWidget(t.newValues[0],t.newIndex);break;case"move":{const e=this._notebookPanel.model.cells.get(t.newIndex);this._moveCellWidget(e,t.newIndex);break}case"remove":this._cleanCellWidgets();break;case"set":{const e=t.oldValues[0];if(null!=e){const s=t.newValues[0];this._cellWidgets.get(e).dispose(),this._cellWidgets.delete(e);const n=this._addCellWidget(s,t.newIndex);n.setActive(this._activeCellModel===s),this._activeCellModel===s&&this._scrollIntoViewNearest(n)}}}}_addCellWidget(e,t=void 0){const s=new U(e,this._notebookPanel);this._cellWidgets.set(e,s),null==t?this.addWidget(s):this.insertWidget(t,s),s.click.connect(this._activeCellWidgetListener,this);const n=this._getMetadataChangedHandler(s);return e.metadataChanged.connect(n),s}_onValidateIds(e,t){"started"==t&&this._validateIds()}_onActiveCellChange(e,t){var s;null!==t?t.ready.then((()=>{var e;null===(e=this._cellWidgets.get(this._activeCellModel))||void 0===e||e.setActive(!1),this._activeCellModel=t.model;const s=this._cellWidgets.get(t.model);null==s||s.setActive(!0),s&&this._scrollIntoViewNearest(s)})):(null===(s=this._cellWidgets.get(this._activeCellModel))||void 0===s||s.setActive(!1),this._activeCellModel=null)}_activeCellWidgetListener(e){const t=this.notebookPanel.content.widgets.find((t=>t.model.id===e.cellModel.id));this.notebookPanel.content.activeCellIndex=this.notebookPanel.content.widgets.indexOf(t)}_onNotebookDisposed(e){this.dispose()}_initCellWidgets(e){for(const t of e.widgets)this._addCellWidget(t.model).setActive(e.activeCell===t)}_getMetadataChangedHandler(e){return(t,s)=>{this.cellMetadataChanged.emit(e)}}_moveCellWidget(e,t){const s=this._cellWidgets.get(e);this.insertWidget(t,s)}_removeCellWidget(e){var t;null===(t=e.click)||void 0===t||t.disconnect(this._activeCellWidgetListener,this),this._cellWidgets.delete(e.cellModel),e.dispose()}_cleanCellWidgets(){null!=this._cellWidgets&&Array.from(this._cellWidgets.values()).filter((e=>e.cellModel.isDisposed)).forEach((e=>{this._removeCellWidget(e)}))}_validateIds(){const e=new Set,t=/^[a-zA-Z0-9_\-]+$/;for(let s of this.notebookPanel.model.cells){const n=A.getNbgraderData(s);if(null==n)continue;const i=n.data.grade_id;if(!t.test(i))return void this._warnInvalidId(!0,!1,i);if(e.has(i))return void this._warnInvalidId(!1,!0,i);e.add(i)}}_validateSchemaVersion(){for(let e of this.notebookPanel.model.cells){const t=A.getNbgraderData(e);let s=null===t?null:t.data.schema_version;if(s=void 0===s?0:s,null!=s&&s<3)return void this._warnSchemaVersion(s)}}_warnInvalidId(e,t,s){const n={buttons:[i.Dialog.okButton()],title:void 0,body:void 0};return e?(n.title="Invalid nbgrader cell ID",n.body="At least one cell has an invalid nbgrader ID. Cell IDs must contain at least one character, and may only contain letters, numbers, hyphens, and/or underscores.",void $(n)):t?(n.title="Duplicate nbgrader cell ID",n.body=`The nbgrader ID "${s}" has been used for more than one cell. Please make sure all grade cells have unique ids.`,void $(n)):void 0}_warnSchemaVersion(e){const t=e.toString(),s=this.notebookPanel.sessionContext.path,n=document.createElement("p"),a=document.createElement("code"),o={title:"Outdated schema version",body:new m.Widget({node:n}),buttons:[i.Dialog.okButton()]};n.innerText=`At least one cell has an old version (${t}) of the nbgrader metadata. Please back up this notebook and then update the metadata on the command line using the following command: `,a.innerText=`nbgrader update ${s}`,n.appendChild(a),$(o)}_scrollIntoViewNearest(e){const t=this.node.scrollTop,s=t+this.node.clientHeight,n=e.node.offsetTop,i=n+e.node.clientHeight;n<t?e.node.scrollIntoView(!0):i>s&&(i-n>s-t?e.node.scrollIntoView(!0):e.node.scrollIntoView(!1))}}class Y extends m.Panel{constructor(e){super(),this.addClass("nbgrader-NotebookPanelWidget"),this._initLayout(e),this._notebookHeaderWidget.totalPoints=this._calcTotalPoints(),e.model.cells.changed.connect(this._onCellListChange,this),this._notebookWidget.cellMetadataChanged.connect(this._onCellMetadataChange,this)}dispose(){var e,t;this.isDisposed||(this._notebookWidget.notebookPanel.model.cells.changed.disconnect(this._onCellListChange,this),this._notebookWidget.cellMetadataChanged.disconnect(this._onCellMetadataChange,this),null===(e=this._notebookHeaderWidget)||void 0===e||e.dispose(),null===(t=this._notebookWidget)||void 0===t||t.dispose(),this._notebookHeaderWidget=null,this._notebookWidget=null,super.dispose())}_calcTotalPoints(){var e;let t=0;for(let s of this._notebookWidget.notebookPanel.model.cells){const n=A.getNbgraderData(s);t+=null!==n&&null!==n.data.points&&(null==n?void 0:n.isGradable())?null===(e=n.data)||void 0===e?void 0:e.points:0}return t}_initLayout(e){this._notebookHeaderWidget=new J,this._notebookWidget=new q(e),this.addWidget(this._notebookHeaderWidget),this.addWidget(this._notebookWidget)}_onCellListChange(e,t){"move"!=t.type&&(this._notebookHeaderWidget.totalPoints=this._calcTotalPoints())}_onCellMetadataChange(e,t){this._notebookHeaderWidget.totalPoints=this._calcTotalPoints()}}var z=s(12);async function Z(e="",t={},s=void 0){const n=new URLSearchParams;if(null!=s)for(const e of s.entries())n.append(e[0],e[1]);const i=c.ServerConnection.makeSettings(),o=a.URLExt.join(i.baseUrl,e)+"?"+n.toString();let l;try{l=await c.ServerConnection.makeRequest(o,t,i)}catch(e){throw new c.ServerConnection.NetworkError(e)}const d=await l.json();if(!l.ok)throw new c.ServerConnection.ResponseError(l,d.message);return d}class K extends i.ToolbarButton{constructor(e){super({className:"validate-button",label:"Validate",onClick:()=>{this.buttonCallback()},tooltip:"Validate Assignment"}),this._buttonCallback=this.newButtonCallback(),this._versionCheckCallback=this.newVersionCheckCallback(),this._saveCallback=this.newSaveCallback(),this.panel=e}get buttonCallback(){return this._buttonCallback}get saveCallback(){return this._saveCallback}get versionCheckCallback(){return this._versionCheckCallback}dispose(){this.isDisposed||(this.panel=null,super.dispose())}newSaveCallback(){return(e,t)=>{if("completed"!==t&&"failed"!==t)return;if(this.panel.context.saveState.disconnect(this.saveCallback),"completed"!==t)return b({title:"Validation failed",body:"Cannot save notebook",buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0),this.setButtonLabel(),void this.setButtonDisabled(!1);this.setButtonLabel("Validating...");const s=this.panel.context.path;Z("assignments/validate",{method:"POST"},new Map([["path",s]])).then((e=>{v(e),this.setButtonLabel(),this.setButtonDisabled(!1)})).catch((e=>{b({title:"Validation failed",body:`Cannot validate: ${e}`,buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0),this.setButtonLabel(),this.setButtonDisabled(!1)}))}}newVersionCheckCallback(){return e=>{!0===e.success?(this.setButtonDisabled(),this.setButtonLabel("Saving..."),this.panel.context.saveState.connect(this.saveCallback),this.panel.context.save()):b({title:"Version Mismatch",body:e.message,buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0)}}newButtonCallback(){return()=>{Z("nbgrader_version",void 0,new Map([["version","0.9.5"]])).then(this.versionCheckCallback).catch((e=>{b({title:"Validation failed",body:`Cannot check version: ${e}`,buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0)}))}}setButtonDisabled(e=!0){const t=this.node.getElementsByTagName("jp-button")[0];e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}setButtonLabel(e="Validate"){this.node.getElementsByClassName("jp-ToolbarButtonComponent-label")[0].innerText=e}}class Q{createNew(e,t){const s=new K(e);let n=0;for(let t of e.toolbar.children()){if(null==t)break;if(t.node.classList.contains("jp-Toolbar-spacer"))break;n++}return e.toolbar.insertItem(n,"runAll",s),new z.DisposableDelegate((()=>{s.dispose()}))}}const X="@jupyter/nbgrader:formgrader",ee={openAssignmentsList:"nbgrader:open-assignment-list",openCoursesList:"nbgrader:open-course-list",openFormgrader:"nbgrader:open-formgrader",openFormgraderLocal:"nbgrader:open-formgrader-local",openCreateAssignment:"nbgrader:open-create-assignment"},te={id:"@jupyter/nbgrader:menu",autoStart:!0,requires:[l.IMainMenu],optional:[i.ICommandPalette,n.ILabShell,h.INotebookShell],activate:(e,t,s,n,i)=>{let o=!1,l=!1;if(i){const e=a.PageConfig.getOption("notebookPage");"tree"===e?o=!0:"notebooks"===e&&(l=!0)}if(!(n||o||l))return;const d=new m.Menu({commands:e.commands});d.id="jp-mainmenu-nbgrader",d.title.label="Nbgrader",(o||n)&&(d.addItem({command:ee.openAssignmentsList}),d.addItem({command:ee.openCoursesList}),d.addItem({command:ee.openFormgrader}),d.addItem({command:ee.openFormgraderLocal}),s&&(s.addItem({command:ee.openAssignmentsList,category:"nbgrader"}),s.addItem({command:ee.openCoursesList,category:"nbgrader"}),s.addItem({command:ee.openFormgrader,category:"nbgrader"}),s.addItem({command:ee.openFormgraderLocal,category:"nbgrader"}))),(l||n)&&(d.addItem({command:ee.openCreateAssignment}),s&&s.addItem({command:ee.openCreateAssignment,category:"nbgrader"})),t.addMenu(d)}},se={id:"@jupyter/nbgrader:assignment-list",autoStart:!0,optional:[n.ILayoutRestorer,u.INotebookTree],activate:(e,t,s)=>{let n,a=new i.WidgetTracker({namespace:"nbgrader-assignment-list"});e.commands.addCommand(ee.openAssignmentsList,{label:"Assignment List",execute:()=>{if(!n||n.isDisposed){const t=new L(e);n=new i.MainAreaWidget({content:t}),n.id="nbgrader-assignment-list",n.addClass("nbgrader-mainarea-widget"),n.title.label="Assignments",n.title.closable=!0}a.has(n)||a.add(n),n.isAttached||(s?(s.addWidget(n),s.currentWidget=n):e.shell.add(n,"main")),n.content.update(),e.shell.activateById(n.id)}}),null!=t&&t.restore(a,{command:ee.openAssignmentsList,name:()=>"nbgrader-assignment-list"}),console.debug("JupyterLab extension assignment-list is activated!")}},ne={id:"@jupyter/nbgrader:course-list",autoStart:!0,optional:[n.ILayoutRestorer,u.INotebookTree],activate:(e,t,s)=>{let n,a=new i.WidgetTracker({namespace:"nbgrader-course-list"});e.commands.addCommand(ee.openCoursesList,{label:"Course List",execute:()=>{if(!n||n.isDisposed){const t=new P(e,null!==s);n=new i.MainAreaWidget({content:t}),n.id="nbgrader-course-list",n.addClass("nbgrader-mainarea-widget"),n.title.label="Courses",n.title.closable=!0}a.has(n)||a.add(n),n.isAttached||(s?(s.addWidget(n),s.currentWidget=n):e.shell.add(n,"main")),n.content.update(),e.shell.activateById(n.id)}}),null!=t&&t.restore(a,{command:ee.openCoursesList,name:()=>"nbgrader-course-list"}),console.debug("JupyterLab extension course-list is activated!")}},ie=[te,{id:X,autoStart:!0,optional:[o.IDefaultFileBrowser,n.ILayoutRestorer,u.INotebookTree,n.IRouter,r.ISettingRegistry],activate:(e,t,s,n,o,l)=>{let d,r=!1,h=new i.WidgetTracker({namespace:"nbgrader-formgrader"});const u=t=>{if(!d||d.isDisposed){const s=new T(e,t);d=new i.MainAreaWidget({content:s}),d.id="formgrader",d.title.label="Formgrader",d.title.closable=!0}h.has(d)||h.add(d),n?(d.isAttached||n.addWidget(d),n.currentWidget=d):d.isAttached||e.shell.add(d,"main"),d.content.update(),e.shell.activateById(d.id)};function m(t){r=t.get("local_config").composite,e.commands.notifyCommandChanged(ee.openFormgraderLocal)}if(e.commands.addCommand(ee.openFormgrader,{label:"Formgrader",execute:e=>{const t=c.ServerConnection.makeSettings();let s=e.url||a.URLExt.join(t.baseUrl,"formgrader");u(s)}}),e.commands.addCommand(ee.openFormgraderLocal,{label:"Formgrader (local)",isVisible:()=>r,execute:e=>{let s="";t&&(s=encodeURIComponent(t.model.path));const n=c.ServerConnection.makeSettings();let i=e.url||a.URLExt.join(n.baseUrl,"formgrader");s&&(i+=`?path=${s}`),u(i)}}),Promise.all([e.restored,l.load(X)]).then((([,e])=>{m(e),e.changed.connect(m)})),o){const e=/(\?|&)formgrader=true/;o.register({command:ee.openFormgrader,pattern:e})}null!=s&&s.restore(h,{command:ee.openFormgrader,name:()=>"nbgrader-formgrader"}),console.debug("JupyterLab extension formgrader is activated!")}},se,ne,{id:"@jupyter/nbgrader:create-assignment",autoStart:!0,requires:[d.INotebookTracker],optional:[n.ILabShell],activate:(e,t,s)=>{const n=new m.Panel;n.node.style.overflowY="auto";const i=new H(t,s);n.addWidget(i),n.id="nbgrader-create_assignemnt",n.title.label="Create Assignment",n.title.caption="Nbgrader Create Assignment",e.shell.add(n,"right"),e.commands.addCommand(ee.openCreateAssignment,{label:"Create assignment",isEnabled:()=>i.isAvailable(),execute:()=>{e.shell.activateById(n.id)}}),console.debug('Extension "create_assignment" activated.')}},{id:"@jupyter/nbgrader:validate-assignment",autoStart:!0,requires:[d.INotebookTracker],activate:e=>{e.docRegistry.addWidgetExtension("Notebook",new Q),console.debug("JupyterLab extension validate-assignment is activated!")}}]}}]);